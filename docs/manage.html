<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>manage.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>manage.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>!/usr/bin/env python</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <h3><span id="project-management-task" href="project-management-task"> Project Management Task </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>The manage.py file relies on the click library for
some quick setup managment tasks via cli</p>
<p>Earthquakes.manage</p>
<p>:author: Regi E. <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#114;&#101;&#103;&#105;&#64;&#112;&#101;&#114;&#115;&#111;&#110;&#97;&#46;&#105;&#111;">&#114;&#101;&#103;&#105;&#64;&#112;&#101;&#114;&#115;&#111;&#110;&#97;&#46;&#105;&#111;</a>
:created: 20141123
:desc: Manages shortcuts for initial development and database
       tasks and tools in a simple interface</p>
<p>:req: rethinkdb [http://rethinkdb.com]
:req: click [http://click.pocoo.org/3/]</p>
<p>Check requirements for all needed cheeseshop installs</p>
<p>Write your code as if the person maintaining it is a
Homicidal Maniac who knows where you live...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess32</span>

<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">rethinkdb</span> <span class="kn">as</span> <span class="nn">r</span>
<span class="kn">from</span> <span class="nn">rethinkdb.errors</span> <span class="kn">import</span> <span class="n">RqlRuntimeError</span><span class="p">,</span> <span class="n">RqlDriverError</span><span class="p">,</span> <span class="n">RqlClientError</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Prints a simple color coded message based on provided level</p>
<p>This function acts a simple syntacal sugar helper for printing
messages using the [click] library.</p>
<p>Args:
    msg (str): Message String [success, warning, error, info]
    level (str, optional): indicated level of message, colored
    coded and displayed in the terminal.</p>
<p>Returns:
    object: Will return a click object</p>
<p>Examples:
    Examples with and without level added</p>
<pre><code>msg('Your info message here')
msg('Your error message here', 'error')
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;info&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">levels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s">&#39;cyan&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">click</span><span class="o">.</span><span class="n">style</span><span class="p">(</span><span class="s">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">fg</span><span class="o">=</span><span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">]))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>TODO: Combine into a single function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">database_check</span><span class="p">(</span><span class="n">provided_msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Simple sanity check helper for databases</p>
<p>This function acts a simple syntacal sugar helper for checking
if a database exist</p>
<p>Args:
    provided_msg (str): Message String
    kwargs (str, optional): [conn, database]</p>
<p>Returns:
    Nothing</p>
<p>Examples:
    database_check(conn=conn)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">provided_msg</span><span class="p">:</span>
        <span class="n">result_msg</span> <span class="o">=</span> <span class="s">&#39;Provided a database[s] name to create or drop [-d] ...&#39;</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;conn&#39;</span><span class="p">]</span>

    <span class="n">msg</span><span class="p">(</span><span class="n">result_msg</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Current Databases -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">db_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Simple sanity check helper for tables</p>
<p>This function acts a simple syntacal sugar helper for checking
if a table exist</p>
<p>Args:
    provided_msg (str): Message String
    kwargs (str, optional): [conn, database]</p>
<p>Returns:
    Nothing</p>
<p>Examples:
    table_check(conn=conn,database=database)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">table_check</span><span class="p">(</span><span class="n">provided_msg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="ow">not</span> <span class="n">provided_msg</span><span class="p">:</span>
        <span class="n">result_msg</span> <span class="o">=</span> <span class="s">&#39;You need to provided table[s] ...&#39;</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;conn&#39;</span><span class="p">]</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">]</span>

    <span class="n">msg</span><span class="p">(</span><span class="n">result_msg</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Current tables in {} -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <h3><span id="rethinkdb-management-tasks" href="rethinkdb-management-tasks"> RethinkDB Management Tasks </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">feed_url</span> <span class="o">=</span> <span class="s">&#39;http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_month.geojson&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Simple sanity check before running any commands</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@click.group</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">rethinkdb_cli</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">28015</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Databases connection established&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">RqlDriverError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Database problem -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Manages database/s based on the provided name[s]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@rethinkdb_cli.command</span><span class="p">()</span>
<span class="nd">@click.argument</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--drop&#39;</span><span class="p">,</span> <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Drop database[s]&quot;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--list&#39;</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;List database[s]&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">database</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>and options passed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">conn</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">28015</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="p">:</span>
        <span class="n">database_check</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">database</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;drop&#39;</span><span class="p">]:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">db_drop</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Database[s] {} dropped ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span> <span class="s">&#39;success&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">db_create</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Database[s] {} created ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span> <span class="s">&#39;success&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;list&#39;</span><span class="p">]:</span>
            <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Current Databases -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">db_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)))</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">RqlClientError</span><span class="p">,</span> <span class="n">RqlRuntimeError</span><span class="p">,</span> <span class="n">RqlDriverError</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Problem creating the database[s] -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Manages table/s based on the provided name[s],</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@rethinkdb_cli.command</span><span class="p">()</span>
<span class="nd">@click.argument</span><span class="p">(</span><span class="s">&#39;tables&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--database&#39;</span><span class="p">,</span> <span class="s">&#39;-db&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Database to added tables&quot;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--drop&#39;</span><span class="p">,</span> <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Drop table[s]&quot;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--list&#39;</span><span class="p">,</span> <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;List table[s]&quot;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--all&#39;</span><span class="p">,</span> <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Will drop all tables in selected database&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_tables</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>database and options</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">conn</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">28015</span><span class="p">)</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="p">:</span>
        <span class="n">database_check</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>TODO: Prompt the user to make sure, they are sure</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_drop</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
            <span class="n">msg</span><span class="p">(</span><span class="s">&#39;All tables dropped ...&#39;</span><span class="p">,</span> <span class="s">&#39;success&#39;</span><span class="p">)</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">RqlClientError</span><span class="p">,</span> <span class="n">RqlRuntimeError</span><span class="p">,</span> <span class="n">RqlDriverError</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Something went wrong -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tables</span><span class="p">:</span>
        <span class="n">table_check</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;list&#39;</span><span class="p">]:</span>
        <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Current Table[s] -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;drop&#39;</span><span class="p">]:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_drop</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Table[s] {} dropped ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span> <span class="s">&#39;success&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_create</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Table[s] {} created in {}...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">database</span><span class="p">),</span> <span class="s">&#39;success&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;list&#39;</span><span class="p">]:</span>
            <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Current Table[s] -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table_list</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)))</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">RqlClientError</span><span class="p">,</span> <span class="n">RqlRuntimeError</span><span class="p">,</span> <span class="n">RqlDriverError</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">(</span><span class="s">&#39;Problem creating the Table[s] -&gt; {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>This function is written only to work with this project and is
brittle by design
Imports feed into database and normalize it</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@rethinkdb_cli.command</span><span class="p">()</span>
<span class="nd">@click.argument</span><span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">)</span>
<span class="nd">@click.argument</span><span class="p">(</span><span class="s">&#39;table&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--index&#39;</span><span class="p">,</span> <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Creates named index for the database&quot;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s">&#39;--geo&#39;</span><span class="p">,</span> <span class="s">&#39;-g&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Create index&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">import_database_feed</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">conn</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">28015</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="p">:</span>
        <span class="n">database_check</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">table_check</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Import the earthquake feed data</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">http</span><span class="p">(</span><span class="n">feed_url</span><span class="p">)[</span><span class="s">&#39;features&#39;</span><span class="p">]</span><span class="o">.</span>
        <span class="n">merge</span><span class="p">(</span><span class="k">lambda</span> <span class="n">quake</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">quake</span><span class="p">[</span><span class="s">&#39;geometry&#39;</span><span class="p">][</span><span class="s">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">quake</span><span class="p">[</span><span class="s">&#39;geometry&#39;</span><span class="p">][</span><span class="s">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])}))</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Add a index for the database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;index&#39;</span><span class="p">]:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">index_create</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;index&#39;</span><span class="p">],</span> <span class="n">geo</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;geo&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <h2>=== Generate Documentation ===</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Uses pycco to document the current code base</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@click.group</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">docs_cli</span><span class="p">():</span>
    <span class="k">pass</span>


<span class="nd">@docs_cli.command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">document</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">subprocess32</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;pycco -d docs/ manage.py app.py&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
